<!DOCTYPE html>
<html>
<head>
    <title>Test Line Feature Extraction</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .feature-box { border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .color-swatch { display: inline-block; width: 30px; height: 20px; border: 1px solid #000; margin-right: 10px; vertical-align: middle; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; max-height: 300px; }
    </style>
</head>
<body>
    <h1>Test Line Feature Extraction</h1>
    <button onclick="testWithSampleData()">Test with Sample JSON</button>
    <button onclick="testWithRealPuzzle()">Test with Real Puzzle (psxczr0jpr)</button>
    <div id="results"></div>

    <!-- Load dependencies -->
    <script src="./src/sudokupad/utilities.js"></script>
    <script src="./src/sudokupad/puzzlezipper.js"></script>
    <script src="./src/sudokupad/fpuzzlesdecoder.js"></script>
    <script src="./src/sudokupad/puzzletools.js"></script>
    <script src="./src/sudokupad/puzzleloader.js"></script>
    <script src="./src/puzzle-converter.js"></script>

    <script>
        const results = document.getElementById('results');
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        function addResult(title, content) {
            const div = document.createElement('div');
            div.innerHTML = `<h3>${title}</h3>${content}`;
            results.appendChild(div);
        }
        
        async function testWithSampleData() {
            clearResults();
            
            // Use sample data from sample-sudokupad.json
            const sampleData = {
                "metadata": {
                    "title": "Pure Toss",
                    "author": "Philipp Blume, aka glum_hippo",
                    "rules": "Standard 159, German Whispers, and Renban rules."
                },
                "lines": [
                    {"wayPoints": [[5.5, 6.5], [3.5, 6.5], [3.5, 7.5], [5.5, 7.5]], "color": "#67f067ff", "thickness": 9.6},
                    {"wayPoints": [[6.5, 3.5], [5.5, 4.5], [6.5, 5.5]], "color": "#67f067ff", "thickness": 9.6},
                    {"wayPoints": [[6.5, 2.5], [4.5, 2.5]], "color": "#67f067ff", "thickness": 9.6},
                    {"wayPoints": [[7.5, 2.5], [8.5, 3.5]], "color": "#67f067ff", "thickness": 9.6},
                    {"wayPoints": [[0.5, 5.5], [2.5, 7.5]], "color": "#67f067ff", "thickness": 9.6},
                    {"wayPoints": [[5.5, 0.5], [3.5, 0.5], [3.5, 1.5], [5.5, 1.5]], "color": "#f067f0ff", "thickness": 9.6},
                    {"wayPoints": [[3.5, 3.5], [2.5, 4.5], [3.5, 5.5]], "color": "#f067f0ff", "thickness": 9.6},
                    {"wayPoints": [[4.5, 8.5], [2.5, 8.5]], "color": "#f067f0ff", "thickness": 9.6},
                    {"wayPoints": [[8.5, 5.5], [6.5, 7.5]], "color": "#f067f0ff", "thickness": 9.6},
                    {"wayPoints": [[0.5, 3.5], [1.5, 2.5]], "color": "#f067f0ff", "thickness": 9.6}
                ]
            };
            
            try {
                console.log('Testing line feature extraction with sample data...');
                const processedData = PuzzleConverter.processPuzzleData(sampleData, 'sample');
                
                addResult('Sample Data Test Results', `
                    <p><strong>Title:</strong> ${processedData.title}</p>
                    <p><strong>Total Lines:</strong> ${processedData.totalLines}</p>
                    <p><strong>Feature Groups:</strong> ${processedData.featureGroups}</p>
                    
                    <h4>Extracted Line Features:</h4>
                    ${processedData.features.map(feature => `
                        <div class="feature-box">
                            <p><strong>Color:</strong> 
                                <span class="color-swatch" style="background-color: ${feature.visual.color};"></span>
                                ${feature.visual.color}
                            </p>
                            <p><strong>Line Count:</strong> ${feature.count}</p>
                            <p><strong>Thickness:</strong> ${feature.visual.thickness}</p>
                            <p><strong>Category:</strong> ${feature.category}</p>
                            <details>
                                <summary>Line Data (${feature.lines.length} lines)</summary>
                                <pre>${JSON.stringify(feature.lines, null, 2)}</pre>
                            </details>
                        </div>
                    `).join('')}
                    
                    <details>
                        <summary>Full Processed Data</summary>
                        <pre>${JSON.stringify(processedData, null, 2)}</pre>
                    </details>
                `);
                
            } catch (error) {
                addResult('Sample Data Test Error', `<pre style="color: red;">${error.message}\n${error.stack}</pre>`);
            }
        }
        
        async function testWithRealPuzzle() {
            clearResults();
            
            try {
                addResult('Real Puzzle Test', '<p>Converting puzzle from https://sudokupad.app/psxczr0jpr...</p>');
                
                const result = await PuzzleConverter.convertSudokuPadUrl('https://sudokupad.app/psxczr0jpr');
                
                addResult('Real Puzzle Test Results', `
                    <p><strong>Title:</strong> ${result.title}</p>
                    <p><strong>Total Lines:</strong> ${result.totalLines}</p>
                    <p><strong>Feature Groups:</strong> ${result.featureGroups}</p>
                    
                    <h4>Extracted Line Features:</h4>
                    ${result.features.map(feature => `
                        <div class="feature-box">
                            <p><strong>Color:</strong> 
                                <span class="color-swatch" style="background-color: ${feature.visual.color};"></span>
                                ${feature.visual.color}
                            </p>
                            <p><strong>Line Count:</strong> ${feature.count}</p>
                            <p><strong>Thickness:</strong> ${feature.visual.thickness}</p>
                            <p><strong>Category:</strong> ${feature.category}</p>
                        </div>
                    `).join('')}
                `);
                
            } catch (error) {
                addResult('Real Puzzle Test Error', `<pre style="color: red;">${error.message}\n${error.stack}</pre>`);
            }
        }
    </script>
</body>
</html>